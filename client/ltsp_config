
if [ -f /etc/lts.conf ]; then
    eval `getltscfg -a`
fi

# Ensure a default for SERVER
if [ -z "$SERVER" -o "$SERVER" = "auto" ]; then
    nfs_server=$(sed -ne '/ltsp.*nfs/ { s/^\([^:]*\):.*$/\1/; p; q }' /proc/mounts)
    if [ -n "$nfs_server" ]; then
        SERVER="$nfs_server"
    else
        SERVER="192.168.0.254"
    fi
    export SERVER
fi

if [ -z "$CONFIGURE_X" ] && [ -x /usr/bin/X ]; then
    export CONFIGURE_X=True
fi

# Ensure a default screen if X is present
if ! env | grep -q '^SCREEN_'; then
    if [ -f /etc/X11/default-display-manager ]; then
        default_display_manager="$(cat /etc/X11/default-display-manager)"
        if [ -x "$default_display_manager" ]; then
            display_manager_configured=true
        elif [ "$default_display_manager" = "/usr/bin/gdm" ] && [ -x /usr/sbin/gdm ]; then
            # some versions of gdm set default-display-manager to /usr/bin/gdm,
            # even if there is no /usr/bin/gdm, but start /usr/sbin/gdm.
            display_manager_configured=true
        fi
    fi
    if [ "$display_manager_configured" = "true" ]; then
        # Do nothing, these daemons (xdm, gdm, kdm, wdm, etc.) should configure themselves.
        true
    elif [ -x /usr/sbin/ldm ]; then
        SCREEN_07=ldm
        export SCREEN_07
    elif [ -x /usr/sbin/sdm ]; then
        SCREEN_07=sdm
        export SCREEN_07
    else
        SCREEN_07=startx
        export SCREEN_07
    fi
fi

# set defaults for sound support
if [ -z "$SOUND_DAEMON" ]; then
    if [ -x /usr/bin/pulseaudio ]; then
        export SOUND_DAEMON=pulse
    elif [ -x /usr/bin/esd ]; then
        export SOUND_DAEMON=esd
    elif [ -x /usr/bin/nasd ]; then
        export SOUND_DAEMON=nasd
    fi
    if [ -z "$SOUND" ] && [ -n "$SOUND_DAEMON" ]; then
        export SOUND=True
    fi
fi  

# set defaults for local device support
if [ -z "$LOCALDEV" ]; then
    if [ -x /usr/bin/ltspfsd ]; then
        export LOCALDEV=True
    fi
fi
