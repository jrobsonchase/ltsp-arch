
if [ -f /etc/lts.conf ]; then
    eval `getltscfg -a`
fi

# set compatbility for ltsp 4.x variables
X_VIDEO_RAM=${X_VIDEO_RAM:-"$X_VIDEORAM"}

# Ensure a default for SERVER
if [ -z "$SERVER" -o "$SERVER" = "auto" ]; then
    nfs_server=$(sed -ne '/ltsp.*nfs/ { s/^\([^:]*\):.*$/\1/; p; q }' /proc/mounts)
    if [ -n "$nfs_server" ]; then
        SERVER="$nfs_server"
    else
        SERVER="192.168.0.254"
    fi
    export SERVER
fi

# Ensure a default screen
if ! env | grep -q '^SCREEN_'; then
    if [ -f /etc/X11/default-display-manager ]; then
        default_display_manager="$(cat /etc/X11/default-display-manager)"
        if [ -x "$default_display_manager" ]; then
            display_manager_configured=true
        elif [ "$default_display_manager" = "/usr/bin/gdm" ] && [ -x /usr/sbin/gdm ]; then
            # some versions of gdm set default-display-manager to /usr/bin/gdm,
            # even if there is no /usr/bin/gdm, but start /usr/sbin/gdm.
            display_manager_configured=true
        fi
    fi
    if [ "$display_manager_configured" = "true" ]; then
        # Do nothing, these daemons (xdm, gdm, kdm, wdm, etc.) should configure themselves.
        true
    elif [ -x /usr/sbin/ldm ]; then
        SCREEN_07=ldm
        export SCREEN_07
    elif [ -x /usr/sbin/sdm ]; then
        SCREEN_07=sdm
        export SCREEN_07
    else
        SCREEN_07=startx
        export SCREEN_07
    fi
fi
