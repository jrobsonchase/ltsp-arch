#
#  Copyright (c) 2005 Canonical LTD
#
#  Author: Matt Zimmerman <mdz@canonical.com>
#
#  2006, Oliver Grawert <ogra@canonical.com>
#        Vagrant Cascadian <vagrant@freegeek.org>
#  2007, Scott Balneaves <sbalneav@ltsp.org>
#        Oliver Grawert <ogra@canonical.com>
#  2008, Vagrant Cascadian <vagrant@freegeek.org>
#        Oliver Grawert <ogra@canonical.com>
#        Warren Togami <wtogami@redhat.com>
#        Gideon Romm <ltsp@symbio-technologies.com>
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of the GNU General Public License as
#  published by the Free Software Foundation; either version 2 of the
#  License, or (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program.  If not, you can find it on the World Wide
#  Web at http://www.gnu.org/copyleft/gpl.html, or write to the Free
#  Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston,
#  MA 02110-1301, USA.
#

#
# ltsp_config: This should be sourced by most scripts within an ltsp
# environment.  Ensures that LTSP5 defaults are set up
#
#

# Source ltsp-common-functions if we have not already (needed in some functions)
# We set PATH to empty string here (in the subshell), because shell will look
# for boolean_is_true in PATH if it doesn't find it as a built-in function
# That search is a waste of time and so, we avoid it by not giving a PATH.
#
# Also, let's call this at the very beginning to make absolutely sure that 
# anything that calls ltsp_config will have ltsp-common-functions sourced
(PATH="" boolean_is_true True 2>/dev/null) || . /usr/share/ltsp/ltsp-common-functions || true

# Don't source this file if it has been sourced already
if [ "$LTSP_CONFIG" = "True" ]; then 
    return 0
fi

# Read in lts.conf entries.
set -f
if [ -f /etc/lts.conf ]; then
    eval $(getltscfg -a) || true
fi
if [ -f /var/cache/getltscfg-cluster/lts.conf ]; then
    eval $(getltscfg -a -c /var/cache/getltscfg-cluster/lts.conf) || true
fi
if [ -f /var/cache/ltsp/ltsp_config ]; then
    . /var/cache/ltsp/ltsp_config
fi

if [ -d /usr/share/ltsp/ltsp_config.d ]; then
    for script in $(run_parts_list /usr/share/ltsp/ltsp_config.d) ; do
        . $script        
    done
fi
set +f
