# This file is sourced
# 
# Generate upstart scripts for all ttys.
# The ttys will stay asleep if no screen is set in lts.conf
# But, if lts.conf changes, the screen will pick up the change

for i in 1 2 3 4 5 6 7 8 9 10 11 12; do
    echo <<EOF >/etc/init/tty${i}.conf
# tty${i}.conf
#
# Automatically generated by ltsp initramfs-scripts
#

description 	"LTSP screen ${i}"
author 		"Gideon Romm"

start on (filesystem
          and (drm-device-added card0 PRIMARY_DEVICE_FOR_DISPLAY=1
               or stopped udevtrigger))
stop on runlevel [016]

respawn
script
    [ -r "/usr/share/ltsp/ltsp_config" ] && . /usr/share/ltsp/ltsp_config 

    # Find current tty, and if it is not the same as SCREEN_DEFAULT, chvt
    if [ -n "${SCREEN_DEFAULT}" ]; then
        chvt ${SCREEN_DEFAULT}
    fi

    if [ -r /etc/default/locale ]; then
	. /etc/default/locale
	export LANG LANGUAGE
    elif [ -r /etc/environment ]; then
	. /etc/environment
	export LANG LANGUAGE
    fi

    exec /usr/share/ltsp/screen_session ${i}
end script

EOF

done
