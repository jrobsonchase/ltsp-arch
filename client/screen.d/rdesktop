#!/bin/sh
#
# The following script works for LTSP5 and was tested in Ubuntu "Feisty" Linux.
# Original rdesktop script by James A. McQuillan,
# modified for LTSP5 by Colin Osterhout of SERRC (www.serrc.org).
#
# This software is licensed under the Gnu General Public License.
# The full text of which can be found at http://www.LTSP.org/license.txt
#
# Call this through /opt/ltsp/i386/etc/lts.conf like this:
#           RDP_OPTIONS  = "-a 16"
#           RDP_SERVER   = w2k3.terminal.server.ip
#           SCREEN_02    = rdesktop
#

PATH=/bin:$PATH; export PATH
. /usr/share/ltsp/screen-x-common
 
RDP_OPTIONS=${RDP_OPTIONS:-"-f"}

RDESKTOP_OPTIONS="${RDP_OPTIONS} -f $* ${RDP_SERVER}"

XINITRC=`mktemp -u /var/run/xinitrc-rdesktop-XXXXXXXXX`
export XINITRC

# Call our global xinitrc script before ldm to run through 
# the init scripts in the xinitrc.d directory
cat <<EOF >${XINITRC}
/usr/share/ltsp/xinitrc
while :; do
    /usr/bin/rdesktop -u "" ${RDESKTOP_OPTIONS} 
done
EOF

/usr/bin/xinit -- ${DISPLAY} vt${TTY} -br >/dev/null

rm -f ${XINITRC}

