#!/bin/sh

set -e

LC_ALL=C
export LC_ALL

ROOT=/opt/ltsp/$(dpkg --print-architecture)
DIST=breezy
MIRROR=http://us.archive.ubuntu.com/ubuntu

debootstrap $DIST $ROOT $MIRROR

chroot $ROOT passwd -l root
echo mousedev >> $ROOT/etc/modules

cat <<EOF > $ROOT/etc/apt/sources.list
deb $MIRROR $DIST main restricted universe
EOF

chroot $ROOT apt-get update

cat <<EOF > $ROOT/etc/kernel-img.conf
warn_initrd = No
do_symlinks = yes
relative_links = yes
link_in_boot = yes
do_bootloader = no
ramdisk=/usr/sbin/mkinitramfs
EOF

DEBIAN_FRONTEND=noninteractive
export DEBIAN_FRONTEND
chroot $ROOT apt-get -y install x-window-system-core ltsp-client discover1 laptop-detect mdetect xresprobe linux

ltsp-update-kernels

rm -f $ROOT/etc/hostname

cat <<'EOF' > $ROOT/etc/network/interfaces
auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
EOF
