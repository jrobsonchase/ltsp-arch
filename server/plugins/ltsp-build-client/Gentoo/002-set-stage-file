case "$MODE" in
    commandline)
        add_option "stage-uri" "`eval_gettext "Stage 3 URI"`" "advanced" "true"
        ;;
    configure)
        if [ -n "$option_stage_uri_value" ] || [ -n "$STAGE_URI" ]; then
            STAGE_URI="${option_stage_uri_value:-$STAGE_URI}"
            PROTOCOL=$(echo ${STAGE_URI} | sed -e 's|://.\+$||')
        fi

        # only download if stage not local
        if [[ "$PROTOCOL" != "file" ]]; then
            STAGE_ARCH=${ARCH}
            DISTFILES_BASE="http://distfiles.gentoo.org/releases/${ARCH}/autobuilds"

            # some architectures use other names in the stagefile
            if [[ "${ARCH}" == "x86" ]]; then
                STAGE_ARCH="i686"
            fi

            # getting the correct stagefile from gentoo and grepping out hardened
            LATEST_STAGE=$( /usr/bin/wget -qO- ${DISTFILES_BASE}/latest-stage3.txt | grep ${STAGE_ARCH}-[0-9]\{8\}" )
            STAGE_URI="${DISTFILES_BASE}/${LATEST_STAGE}"

            if [[ "${STAGE_URI}" != *.tar.bz2 ]]; then
                printf "`eval_gettext "Failed finding stage in: ${STAGE_URI}"`\n"
                STAGE_URI=""
            fi
        fi
        ;;
esac
