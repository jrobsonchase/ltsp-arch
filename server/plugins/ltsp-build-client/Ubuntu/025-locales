case $MODE in
    commandline)
        add_option "locale" "`eval_gettext "Set the default locale"`" "advanced" "false"
        ;;
    configure)
        if [ -n "$option_locale_value" ]; then
            LOCALE="$option_locale_value"
        fi
        ;;
    install)
        if [ -z "$LOCALE" ]; then
            LOCALE="$LANG"
        fi
        chroot $ROOT locale-gen $LOCALE

        if [ -f /etc/environment ]; then
            cp /etc/environment $ROOT/etc/
        else
            echo "LANG=$LOCALE" >> $ROOT/etc/environment
        fi
        export LANG="$LOCALE"

        if [ -f /etc/default/console-setup ]; then
            cp /etc/default/console-setup $ROOT/etc/default/console-setup
        fi
        ;;
    finalization)

        KMAP=$(echo "get xserver-xorg/config/inputdevice/keyboard/layout"| debconf-communicate >/dev/null 2&>1 && echo "get xserver-xorg/config/inputdevice/keyboard/layout" | debconf-communicate 2>/dev/null | cut -d ' ' -f 2)
        if [ -n "$KMAP" ]; then
            chroot $ROOT echo "set xserver-xorg/config/inputdevice/keyboard/layout $KMAP" | debconf-communicate xserver-xorg
            chroot $ROOT echo "fset xserver-xorg/config/inputdevice/keyboard/layout seen true" | debconf-communicate xserver-xorg
        fi
        ;;
esac
