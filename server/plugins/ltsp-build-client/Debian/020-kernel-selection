case "$MODE" in
    commandline)
        add_option "kernel-packages" "`eval_gettext "set the list of kernel packages to install."`" "advanced" "true"
        ;;
    configure)
        if [ -n "$option_kernel_packages_value" ]; then
            KERNEL_PACKAGES="$(echo $option_kernel_packages_value | tr ',' ' ')"
        fi
        ;;
    before-install)
        if [ -z "$KERNEL_PACKAGES" ]; then
           # select a kernel
           KERNEL_BASE="linux-image"
           case $ARCH in
               i386)
                  KERNEL_ARCH="486"
                  ;;
               sparc) 
                   KERNEL_ARCH="$(uname -m)"
                   ;;
               alpha)
                   KERNEL_ARCH="alpha-generic"
                   ;;
               powerpc|amd64) 
                   KERNEL_ARCH="$ARCH"
                   ;;
               *)
                   # generic kernel unknown, select the running kernel
                   KERNEL_VERSION="$(uname -r)"
                   KERNEL_PACKAGES="$KERNEL_BASE-$KERNEL_VERSION"
                   if [ "$HOST_ARCH" != "$ARCH" ]; then
                        echo "ERROR: unable to determine cross-architecture kernel"
                        echo "please select kernel with with --kernel-packages"
                   fi
                   ;;
           esac
           if [ -z "$KERNEL_PACKAGES" ]; then
                test -n "$KERNEL_VERSION" && KERNEL_BASE="$KERNEL_BASE-$KERNEL_VERSION"
                test -n "$KERNEL_ARCH" && KERNEL_PACKAGES="$KERNEL_BASE-$KERNEL_ARCH"
           fi
        fi
        test -n "$KERNEL_PACKAGES" && LATE_PACKAGES="$LATE_PACKAGES $KERNEL_PACKAGES"
        ;;
esac
