# Gentoo-specific function overrides for ltsp-update-kernels

cleanup_kernels() {
    for kernelpath in $(find "$tftpboot/$arch/" -name 'kernel-genkernel-*'); do
        kernel=${kernelpath##*/}
        archversion=${kernel#kernel-genkernel-}
        version=${archversion#*-}

        if [ ! -d "$chroot/lib/modules/$version" ]; then
          echo "Removing $kernelpath"
          rm -f "$tftpboot/$arch/kernel-genkernel-$archversion"
          rm -f "$tftpboot/$arch/initramfs-genkernel-$archversion"
          rm -f "$tftpboot/$arch/System.map-genkernel-$archversion"
        fi
    done
}
