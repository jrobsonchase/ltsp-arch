#!/usr/bin/python
import sys
import locale
from subprocess import *

def compute_server_rating():
    """Compute the server rating from it's state"""
    return 5

if __name__ == "__main__":
    # Get the server's default locale
    # We want it to appear first in the list
    name, encoding = locale.getdefaultlocale()
    defaultlocale = name + "." + encoding
    defaultlocale = defaultlocale.replace('UTF8', 'UTF-8')
    print "language:" + defaultlocale
    # Get list of valid locales from locale -a
    try:
        lines = Popen(['locale', '-a'], stdout=PIPE).communicate()[0]
    except OSError:
        print "ERROR"
        sys.exit(0)
    langs = lines.split(None)
    langs.sort()
    for lang in langs:
        lang = lang.rstrip()
        if lang.endswith('.utf8'):
            # locale returns .utf8 when we want .UTF-8
            lang = lang.replace('.utf8','.UTF-8')
        if lang != 'POSIX' and lang != 'C' and lang != defaultlocale:
            print "language:" + lang
    try:
        lines = []
        for alternative in ['x-session-manager','x-window-manager']:
            lines.extend(Popen(['/usr/sbin/update-alternatives', '--list',
                         alternative ], stdout=PIPE).communicate()[0].split())
    except OSError:
        print "ERROR"
        sys.exit(0)
    for line in lines:
        print "session:" + line

    # Get the rating of this server
    rate = 0
    try:
        rate = compute_server_rating()
    except:
        print "ERROR"
        sys.exit(0)
    print "rating:" + str(compute_server_rating())

